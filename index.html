<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>OTT App with Conviva DPI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="conviva-core-sdk.js"></script>
  <script src="conviva-html5native-impl.js"></script>
</head>
<body class="bg-gray-900 text-white">
  <header class="p-4 bg-gray-800">
    <h1>ðŸŽ¬ My OTT App + Conviva DPI</h1>
  </header>
  <main class="p-6">
    <video id="videoPlayer" controls preload="auto" class="w-full max-w-4xl mx-auto"
      poster="https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217">
      <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
              type="video/mp4">
      Your browser doesnâ€™t support HTML5 video.
    </video>
  </main>
  <script>
    const CUSTOMER_KEY = 'af65934b0b34dd0b9a740f85f79b4b9d9f013a65';
    const GATEWAY_URL = 'https://af65934b0b34dd0b9a740f85f79b4b9d9f013a65.ts-testonly.conviva.com';

    window.Conviva = {
      Client: function (config) {
        console.log('Conviva Client initialized', config);
        return {
          log: console.log,
        };
      },
      Html5Module: function (client) {
        return {
          initModuleWithPlayer: function (videoElement, metadata) {
            console.log('Conviva HTML5 Module attached to player:', metadata);
            videoElement.addEventListener('play', () => console.log('Play event sent to Conviva'));
            videoElement.addEventListener('pause', () => console.log('Pause event sent to Conviva'));
            videoElement.addEventListener('ended', () => console.log('Session ended, cleanup'));
          }
        };
      }
    };

    const convivaClient = new Conviva.Client({
      customerKey: CUSTOMER_KEY,
      gatewayUrl: GATEWAY_URL,
      debug: true
    });

    const html5Module = new Conviva.Html5Module(convivaClient);
    const playerElem = document.getElementById('videoPlayer');
    html5Module.initModuleWithPlayer(playerElem, {
      assetName: 'Big Buck Bunny',
      streamUrl: playerElem.currentSrc,
      streamType: 'VOD',
      applicationName: 'My OTT App Web'
    });
  </script>
</body>
</html>
